"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[653],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return m}});var o=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},i=Object.keys(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=o.createContext({}),u=function(e){var t=o.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},c=function(e){var t=u(e.components);return o.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},p=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),p=u(n),m=a,h=p["".concat(l,".").concat(m)]||p[m]||d[m]||i;return n?o.createElement(h,r(r({ref:t},c),{},{components:n})):o.createElement(h,r({ref:t},c))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,r=new Array(i);r[0]=p;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,r[1]=s;for(var u=2;u<i;u++)r[u]=n[u];return o.createElement.apply(null,r)}return o.createElement.apply(null,n)}p.displayName="MDXCreateElement"},2623:function(e,t,n){n.r(t),n.d(t,{assets:function(){return c},contentTitle:function(){return l},default:function(){return m},frontMatter:function(){return s},metadata:function(){return u},toc:function(){return d}});var o=n(7462),a=n(3366),i=(n(7294),n(3905)),r=["components"],s={sidebar_position:5,title:"Security Considerations"},l=void 0,u={unversionedId:"security",id:"security",title:"Security Considerations",description:"Why Windows doesn't have a sudo command?",source:"@site/docs/security.md",sourceDirName:".",slug:"/security",permalink:"/gsudo/docs/security",editUrl:"https://github.com/gerardog/gsudo/blob/docs/docs/docs/security.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5,title:"Security Considerations"},sidebar:"tutorialSidebar",previous:{title:"Credentials Cache",permalink:"/gsudo/docs/credentials-cache"},next:{title:"How it works",permalink:"/gsudo/docs/how-it-works"}},c={},d=[{value:"Why Windows doesn&#39;t have a <code>sudo</code> command?",id:"why-windows-doesnt-have-a-sudo-command",level:2},{value:"Is it safe to run gsudo?",id:"is-it-safe-to-run-gsudo",level:2}],p={toc:d};function m(e){var t=e.components,n=(0,a.Z)(e,r);return(0,i.kt)("wrapper",(0,o.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"why-windows-doesnt-have-a-sudo-command"},"Why Windows doesn't have a ",(0,i.kt)("inlineCode",{parentName:"h2"},"sudo")," command?"),(0,i.kt)("p",null,"To answer this question, we first have to take a look back at the history."),(0,i.kt)("p",null,"In August 2002, Chris Paget released a white paper describing a form of attack against event-driven systems that he termed Shatter Attack. It allowed processes in the same session to bypass security restrictions by abussing Windows Message loop."),(0,i.kt)("p",null,'Microsoft response was to add "User Interface Privilege Isolation" (UIPI) and the "User Access Control" (UAC) popup to the next mayor release: Windows Vista. Privileged processes would then ran "elevated", out of reach of lower non-admin processes.'),(0,i.kt)("p",null,"I assume that at this point Microsoft decided not to make a ",(0,i.kt)("inlineCode",{parentName:"p"},"sudo")," tool for windows. It would be an unwanted bridge between two intentionally (supposedly) isolated worlds.."),(0,i.kt)("p",null,"But, let me ",(0,i.kt)("a",{parentName:"p",href:"https://devblogs.microsoft.com/oldnewthing/20160816-00/?p=94105"},"quote Raymond Chen from Microsoft"),":"),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"There\u2019s a setting that lets you specify how often you want to be prompted by UAC. You can set any of four levels:"),(0,i.kt)("ul",{parentName:"blockquote"},(0,i.kt)("li",{parentName:"ul"},"Always notify"),(0,i.kt)("li",{parentName:"ul"},"Notify only when apps try to change settings, use the secure desktop ",(0,i.kt)("inlineCode",{parentName:"li"},"(Default mode)")),(0,i.kt)("li",{parentName:"ul"},"Notify only when apps try to change settings, don\u2019t use the secure desktop"),(0,i.kt)("li",{parentName:"ul"},"Never notify")),(0,i.kt)("p",{parentName:"blockquote"},"Although it looks like there are four settings, in a theoretical sense, there really are only two settings."),(0,i.kt)("ul",{parentName:"blockquote"},(0,i.kt)("li",{parentName:"ul"},"Always notify"),(0,i.kt)("li",{parentName:"ul"},"Meh")),(0,i.kt)("p",{parentName:"blockquote"},"The reason why all the other options collapse into Meh is that the ",(0,i.kt)("inlineCode",{parentName:"p"},"Notify only when apps try to change settings")," option can be subverted by any app simply by (...)")),(0,i.kt)("p",null,'And, up to this day, Windows 10 & 11, defaults to "Meh". Why? User convenience (against security).'),(0,i.kt)("p",null,"Later, it was assumed publicily that ",(0,i.kt)("inlineCode",{parentName:"p"},"UIPI")," in default mode is not a security boundary. I will ",(0,i.kt)("a",{parentName:"p",href:"https://docs.microsoft.com/en-us/troubleshoot/windows-server/windows-security/disable-user-account-control#:~:text=More%20important%2C%20Same%2Ddesktop%20Elevation,be%20considered%20a%20convenience%20feature."},"quote Microsoft documentation")," :"),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"Same-desktop Elevation in UAC isn't a security boundary. It can be hijacked by unprivileged software that runs on the same desktop. Same-desktop Elevation should be considered a convenience feature.")),(0,i.kt)("p",null,"This literally means: ",(0,i.kt)("b",null,"UAC is a tool that protects you from shooting yourself in the foot. The only thing that protects you from malicious processes is your Anti Virus software"),"."),(0,i.kt)("p",null,"This contradicts the premises on which they decided not to create a Windows ",(0,i.kt)("inlineCode",{parentName:"p"},"sudo"),": If UAC can be hijacked, if it is not really a complete isolation that ",(0,i.kt)("inlineCode",{parentName:"p"},"sudo")," will break, and is meant to protect you from yourself (running as admin something not intended to be admin), then Windows UIPI isolation without ",(0,i.kt)("inlineCode",{parentName:"p"},"sudo")," is not always the best alternative, because:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"You loose important time by switching between elevated and unelevated windows, which leads you to elevate the whole console beforehand, effectively running non-admin stuff as admin to minimize context switching..."),(0,i.kt)("li",{parentName:"ul"},"... or even worse: you suffer from \"elevation fatigue\", which is, you tend to elevate everything console 'just in case' one future command could require admin privileges.")),(0,i.kt)("p",null,"Therefore, in my opinion, the best way to not shoot yourself in the foot is to use a ",(0,i.kt)("inlineCode",{parentName:"p"},"sudo")," tool that allows you to easily cherry-pick which commands to elevate."),(0,i.kt)("h2",{id:"is-it-safe-to-run-gsudo"},"Is it safe to run gsudo?"),(0,i.kt)("p",null,"To answer this question, lets explore how gsudo could be used as an attack vector for escalation of privileges."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"It could allow a medium integrity process to drive a high integrity/admin process"),": "),(0,i.kt)("p",{parentName:"li"},"When gsudo is elevates in the same console, it creates a connection between a medium and a high integrity process. A malicious process (at medium integrity) can then drive the medium integrity console hosting the high integrity process. For example, by sending keystrokes and scrapping the screen."),(0,i.kt)("p",{parentName:"li"},"This also applies to other apps that perform mixed elevation today."),(0,i.kt)("p",{parentName:"li"},"But, if UAC can be hijacked directly, and your AV is your only protection: What's the difference when using a ",(0,i.kt)("inlineCode",{parentName:"p"},"sudo")," tool?")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Abusing ",(0,i.kt)("inlineCode",{parentName:"strong"},"gsudo cache")," to elevate a process silently:")," "),(0,i.kt)("p",{parentName:"li"}," ",(0,i.kt)("inlineCode",{parentName:"p"},"gsudo credentials cache")," allows many elevations with only one UAC popup. But there is a reason why the cache is disabled by default: AFAIK its impossible to secure a running instance of the credentials cache without changing Windows itself."),(0,i.kt)("p",{parentName:"li"}," The process that invokes gsudo will be allowed by the cache (when enabled) to elevate again, but is running at the unprotected medium integrity level. A malicious process also at medium level can inject it's code in the allowed process and trick gsudo to request elevation silently.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Bugs in gsudo itself"),":"),(0,i.kt)("p",{parentName:"li"}," Any piece of software may contain bugs. And ",(0,i.kt)("inlineCode",{parentName:"p"},"gsudo")," is no exception. The source code is available since the first release and code reviews and audits are always welcome."))))}m.isMDXComponent=!0}}]);